/**
 * Created by tanhaican on 2016/12/10.
 */
define(function(require,exports,module){var sTpl=require("templates/modules/teacher/verify.html"),Constants=require("js/common/Constants"),Utils=require("js/common/Utils"),getMyVeifyGrouponsURL=Constants.APP_SERVER_URL+"group/search/findGroupByPage",verifyByCodeURL=Constants.APP_SERVER_URL+"order/validPass",pageIndex=1;require("js/lib/layer_mobile/layer.js"),require("js/lib/layer_mobile/need/layer.css");var Verify=Vue.extend({template:sTpl,data:function(){return{ctrl:{},openId:null,myVeifyGrouponList:[]}},ready:function(data){this.fetchData(pageIndex)},route:{data:function(transition){var vm=this;vm.openId=transition.to.params.openId}},watch:{grouponPwdList:function(val,oldVal){this.generateQrcode(val)}},methods:{fetchData:function(_pageIndex){var vm=this;GrouponService.getMyVeifyGroupons(vm.openId,_pageIndex,function(data){Utils.concatArr(vm.myVeifyGrouponList,data&&data.rows||[])})},verifyByCode:function(){var vm=this,inputPwd=vm.ctrl.inputPwd;return inputPwd?void GrouponService.verifyByCode(inputPwd,function(){layer.open({content:"验证成功",btn:"我知道了"})}):void layer.open({time:1,skin:"msg",content:"请输入预约密码后验证"})},verifyByWx:function(){wx.scanQRCode({needResult:0,scanType:["qrCode","barCode"],success:function(res){var result=res.resultStr;console.log(result)}}),wx.error(function(res){alert(res.errMsg)})},toVeirifiedList:function(grouponId,count){var vm=this;vm.$router.go({name:"teacherVerifiedList",params:{grouponId:grouponId,count:count}})}}}),GrouponService={getMyVeifyGroupons:function(openId,pageIndex,callback){var param={teacherOpenid:openId,page:pageIndex||1,rows:Constants.PAGE_INFO.PAGE_SIZE},promise=Utils.post(getMyVeifyGrouponsURL,param);promise.then(function(response){var retObj=response.body;retObj&&1===retObj.code?callback&&callback(retObj.obj):layer.open({time:1,skin:"msg",content:retObj.msg})},function(response){layer.open({time:1,skin:"msg",content:"请求数据失败"})})},verifyByCode:function(password,callback){var param={password:password},promise=Utils.post(verifyByCodeURL,param);promise.then(function(response){var retObj=response.body;retObj&&1===retObj.code?callback&&callback(retObj.obj):layer.open({time:1,skin:"msg",content:retObj.msg})},function(response){layer.open({time:1,skin:"msg",content:"请求数据失败"})})}};module.exports=Verify});