/**
 * Created by tanhaican on 2016/12/10.
 */
define(function(require,exports,module){var openId,sTpl=require("templates/modules/parent/my_verify_code.html"),Constants=require("js/common/Constants"),Utils=require("js/common/Utils"),getMyGrouponPwdListURL=Constants.APP_SERVER_URL+"order/search/findGroupOrderPwdByPage",pageIndex=1;require("js/lib/qrcode.min"),require("js/lib/layer_mobile/layer.js"),require("js/lib/layer_mobile/need/layer.css");var MyVerifyCode=Vue.extend({template:sTpl,data:function(){return{grouponPwdList:[]}},ready:function(data){this.fetchData(pageIndex)},route:{data:function(transition){openId=transition.to.params.openId}},watch:{grouponPwdList:function(val,oldVal){this.generateQrcode(val)}},methods:{fetchData:function(_pageIndex){var vm=this;GrouponService.getMyGrouponPwdList(openId,_pageIndex,function(data){Utils.concatArr(vm.grouponPwdList,data&&data.rows||[])})},generateQrcode:function(grouponPwdList){if(grouponPwdList&&grouponPwdList.length)for(var i=0,length=grouponPwdList.length;i<length;i++){var grouponPwd=grouponPwdList[i];new QRCode("qrcode"+grouponPwd.groupId,grouponPwd.password)}}}}),GrouponService={getMyGrouponPwdList:function(openId,pageIndex,callback){var param={openid:openId,page:pageIndex||1,rows:Constants.PAGE_INFO.PAGE_SIZE},promise=Utils.post(getMyGrouponPwdListURL,param);promise.then(function(response){var retObj=response.body;retObj&&1===retObj.code?callback&&callback(retObj.obj):layer.open({time:1,skin:"msg",content:retObj.msg})},function(response){layer.open({time:1,skin:"msg",content:"请求数据失败"})})}};module.exports=MyVerifyCode});